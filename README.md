# sampling-ABM-runs
This repository contains scripts used in a research project on the design of experiments with agent-based models (ABMs). The aim of the project is to evaluate the performance of various approaches to sampling the design space of ABM experiments.

The scripts do the following:
1. Import a dataset with results from a factorial experiment run with an ABM of residential segregation (Flache & de Matos Fernandes, 2021) (see details below);
2. Simulate sampling-based experiment designs by sampling a subset of the available conditions via different competing approaches.
3. For each prescribed condition of each simulated experiment, the scripts select one run with matching conditions from the imported dataset point 1). This produces an ensemble of 'simulated experiments' obtained by sampling and re-sampling ABM runs with the prescribed conditions from the factorial experiment dataset.
4. Evaluate the performance of each experiment in terms of CPU time required to execute the prescribed ABM runs (a measure of efficiency of the experiment), and in terms of distance between the regression estimantes obtained using sampled runs and the same estimates obtained with the factorial experiment (a measure of experiment efficacy). By averaging across all experiments generated by each of the competing approaches to design space sampling, the scripts estimate the _average_ efficiency and efficacy of each approach.
5. Plot results and save plots to file.

The following sections outline the content of the repository.


## sampling_demonstration.r
This script imports the dataset created with NetLogo/BehaviorSpace and saved in _./input/_ , simulates ABM experiments with different design space sampling approaches, evaluates the experiments and plots the results. Plots are saved in _./output/_.

_This script runs in R 4.3.1 and requires the following libraries to be installed:_ clhs, AlgDesign, lubridate, fpc, reshape2, ggplot2, openxlsx.


## util.r
This script is 'sourced' by _sampling_demonstration.r_. It contains some utility functions for transforming data, plotting and drawing samples.


## ./input/SegregationExtended_TF full-factorial version 2-table.csv
This is the dataset with the results from a factorial experiment with the ABM of residential segregation. The model (Flache & de Matos Fernandes, 2021) is publicly available from the Comses repository at [this address](https://www.comses.net/codebases/7c562b23-4964-4d28-862c-1c8b254fd6ad/releases/1.0.0/). Here are the instructions to reproduce the factorial experiment and a file that is functionally equivalent to the one used here.

1. Make sure you have installed NetLogo 6.3.
2. Download the ABM the Comses repository.
3. Unzip the downloaded folder, browse to introducing-two-extensions-of-schellings-segregation-model_v1.0.0.zip\code\, and launch SegregationExtended.nlogo with NetLogo.
4. Navigate to Tools -> BehaviorSpace. A window pops up. Click on "New" to create a new BehaviorSpace experiment.
5. A new window allows to specify the configuration of the new BehaviorSpace experiment. Enter the following values.
* Field "Experiment name" -> Any string, e.g. "test".
* Field "Vary variables as follows [...]" -> paste the following text:
> ["maxTicks" 500]
> 
> ["density" [70 5 90]]
> 
> ["%-similar-wanted" [5 5 100]]
> 
> ["radiusNeighborhood" 1.5 2 3 4 5 6 7 8]
> 
> ["fourGroups" false true]
> 
> ["noise" 0]
> 
> ["stepsBetweenUpdates" 1]
> 
> ["BlackWhiteVis" false] 

 * Field "Repetitions" -> 10
 * Field "Run combinations in sequential order" -> does not matter: can be left unticked.
 * Field "Measure runs using these reporters:" -> paste the following text:

>seed
>
>num-Population
>
>num-Red-Population
>
>num-Green-Population
>
>num-Blue-Population
>
>num-Yellow-Population
>
>percent-Red-Population
>
>percent-Green-Population
>
>percent-Blue-Population
>
>percent-Yellow-Population
>
>percent-similar-0
>
>percent-similar-Red-0
>
>percent-similar-Green-0
>
>percent-similar-Blue-0
>
>percent-similar-Yellow-0
>
>percent-unhappy-0
>
>percent-unhappy-Red-0
>
>percent-unhappy-Green-0
>
>percent-unhappy-Blue-0
>
>percent-unhappy-Yellow-0
>
>percent-similar
>
>percent-similar-Red
>
>percent-similar-Green
>
>percent-similar-Blue
>
>percent-similar-Yellow
>
>percent-unhappy
>
>percent-unhappy-Red
>
>percent-unhappy-Green
>
>percent-unhappy-Blue
>
>percent-unhappy-Yellow
>
>percent-clustering-Red
>
>percent-clustering-Green
>
>percent-clustering-Blue
>
>percent-clustering-Yellow
>
>ticks
>
>timer

* Field "Measure runs at every step" -> Unchecked
* Field "Setup commands" -> paste:
>reset-timer
>
>setup

* Field "Go commands" -> paste the sting:
> go

* Field "Time limit" -> 0

6. Then click on "Ok" to save the experiment.
7. You should be back at the screen that lists all available BehaviorSpace experiments. The newly-created experiment should be at the bottom of the list. Select it and click on "Run".
8. A new window pops up. Disable "Spreadsheet output" and a path for "Table output". The path should point to the "input" folder of this repository: _./input/SegregationExtended_TF full-factorial version 2-table.csv_ (note the filename of the csv output). All other settings on this screen can be left to their default.
9. Upon clicking on "Ok", NetLogo will start running the factorial experiment and write results in the file specified in the previous point. Depending on the processor configuration and the number of cores allocated to the experiment, the experiment will run for a few hours. The end of the experiment is signaled by the automatic closing of the BehaviorSpace window.


## References
Andreas Flache, Carlos A. de Matos Fernandes (2021, January 25). _Introducing two extensions of Schellingâ€™s segregation model_ (Version 1.0.0). CoMSES Computational Model Library. Retrieved from: https://www.comses.net/codebases/7c562b23-4964-4d28-862c-1c8b254fd6ad/releases/1.0.0/
 
